<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Klasa Tutorial: Understanding Setting Gateway</title>
	<link rel="shortcut icon" href="img/favicon.ico">

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.dark.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Klasa</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="ArgResolver.html">ArgResolver</a></li><li><a href="Command.html">Command</a></li><li><a href="CommandStore.html">CommandStore</a></li><li><a href="Configuration.html">Configuration</a></li><li><a href="Event.html">Event</a></li><li><a href="EventStore.html">EventStore</a></li><li><a href="Extendable.html">Extendable</a></li><li><a href="ExtendableStore.html">ExtendableStore</a></li><li><a href="Finalizer.html">Finalizer</a></li><li><a href="FinalizerStore.html">FinalizerStore</a></li><li><a href="Gateway.html">Gateway</a></li><li><a href="GatewayDriver.html">GatewayDriver</a></li><li><a href="GatewaySQL.html">GatewaySQL</a></li><li><a href="Inhibitor.html">Inhibitor</a></li><li><a href="InhibitorStore.html">InhibitorStore</a></li><li><a href="KlasaClient.html">KlasaClient</a></li><li><a href="KlasaConsole.html">KlasaConsole</a></li><li><a href="KlasaGuild.html">KlasaGuild</a></li><li><a href="KlasaMessage.html">KlasaMessage</a></li><li><a href="KlasaUser.html">KlasaUser</a></li><li><a href="Language.html">Language</a></li><li><a href="LanguageStore.html">LanguageStore</a></li><li><a href="Monitor.html">Monitor</a></li><li><a href="MonitorStore.html">MonitorStore</a></li><li><a href="ParsedUsage.html">ParsedUsage</a></li><li><a href="PermissionLevels.html">PermissionLevels</a></li><li><a href="Piece.html">Piece</a></li><li><a href="Possible.html">Possible</a></li><li><a href="Provider.html">Provider</a></li><li><a href="ProviderStore.html">ProviderStore</a></li><li><a href="ReactionHandler.html">ReactionHandler</a></li><li><a href="Resolver.html">Resolver</a></li><li><a href="RichDisplay.html">RichDisplay</a></li><li><a href="RichMenu.html">RichMenu</a></li><li><a href="Schema.html">Schema</a></li><li><a href="SchemaPiece.html">SchemaPiece</a></li><li><a href="SettingResolver.html">SettingResolver</a></li><li><a href="Stopwatch.html">Stopwatch</a></li><li><a href="Store.html">Store</a></li><li><a href="Tag.html">Tag</a></li><li><a href="Util.html">Util</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-GettingStarted.html">Getting Started</a></li><li><a href="tutorial-IncludedPieces.html">Included Pieces</a></li><li><a href="tutorial-PieceStores.html">Custom Pieces and Stores</a></li><li><a href="tutorial-RichDisplay_.html">Using RichDisplay for Paginated Embeds</a></li><li><a href="tutorial-UnderstandingPermissionLevels.html">Understanding Permission Levels</a></li><li><a href="tutorial-UnderstandingSettingGateway.html">Understanding Setting Gateway</a></li><li><a href="tutorial-UnderstandingUsageStrings.html">Understanding Usage Strings</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html">Global</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    <h1>Understanding Setting Gateway</h1>
</header>

<article>
    <h1>SettingGateway</h1>
<p>The SettingGateway is designed to provide users a very useful interface for managing data. Each instance is able to handle a completely different schema and database.</p>
<p>By default, Klasa uses the <a href="https://github.com/dirigeants/klasa/blob/master/src/providers/json.js">json</a> provider. Do not be fooled and insta-replace with SQLite, Klasa's JSON provider writes the data <a href="https://en.wikipedia.org/wiki/Atomicity_(database_systems)">atomically</a>, in other words, it is very rare for the data to corrupt.</p>
<p>However, as Klasa works on a <a href="https://en.wikipedia.org/wiki/NoSQL">NoSQL</a> environment, however, SQL parsing has been improved to reduce the NoSQL middleware processing and be able to match it in performance's speed. SQL providers also need a special set of methods and properties to make the provider <code>SQL</code> compatible.</p>
<h2>Change the <em>provider's engine</em>.</h2>
<p>For example, let's say I have downloaded the <em>levelup</em> provider and I want to work with it, then we go to your main script file (<code>app.js</code>, <code>bot.js</code>..., wherever you declare the new Klasa.Client), and write the following code:</p>
<pre class="prettyprint source lang-javascript"><code>provider: { engine: 'levelup' }
</code></pre>
<p>Your Klasa's configuration will look something like this:</p>
<pre class="prettyprint source lang-javascript"><code>const client = new Klasa.Client({
  ownerID: '',
  prefix: 'k!',
  clientOptions: {},
  provider: { engine: '' },
});

client.login('A_BEAUTIFUL_TOKEN_AINT_IT?');
</code></pre>
<p>And now, you're using levelup's provider to store the data from SettingGateway.</p>
<p>What happens when I use an engine that does not exist as a provider? Simply, SettingGateway will throw an error, it is enough user-friendly and readable, if that happens, make sure you wrote the provider's name correctly.</p>
<h2>Add new 'keys' to the guild configuration's schema.</h2>
<p>You can easily add keys to the schema by doing this:</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.guilds.schema.addKey(key, options, force?);
</code></pre>
<p>Where:</p>
<ul>
<li><code>key</code> is the key's name to add, <code>String</code> type.</li>
<li><code>options</code> is an object containing the options for the key, such as <code>type</code>, <code>default</code>, <code>sql</code>, <code>array</code>...</li>
<li><code>force</code> (defaults to <code>true</code>) is whether SchemaManager should update all documents/rows to match the new schema, using the <code>options.default</code> value.</li>
</ul>
<p>For example, let's say I want to add a new configuration key, called <code>modlogs</code>, which takes a channel.</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.guilds.schema.addKey('modlogs', { type: 'TextChannel' });
</code></pre>
<p>This will create a new configuration key, called <code>modlogs</code>, and will take a <code>TextChannel</code> type.</p>
<blockquote>
<p>The force parameter defaults to <code>true</code> instead to <code>false</code>. It is also recommended to use it as it can avoid certain unwanted actions.</p>
</blockquote>
<p>But now, I want to add another key, with name of <code>users</code>, <em>so I can set a list of blacklisted users who won't be able to use commands</em>, which will take an array of Users.</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.guilds.schema.addKey('users', { type: 'User', array: true });
</code></pre>
<blockquote>
<p><code>options.array</code> defaults to <code>false</code>, and when <code>options.default</code> is not specified, it defaults to <code>null</code>, however, when <code>options.array</code> is <code>true</code>, <code>options.default</code> defaults to <code>[]</code> (empty array).</p>
</blockquote>
<p>What have we done? <code>client.gateways.guilds.schema</code> is a <strong>Schema</strong> instance (also called Folder type) which can manage itself, such as adding keys/folders to itself (it certainly follows the OOP paradigm).</p>
<h2>Editing keys from the guild configuration.</h2>
<p>Now that I have a new key called <code>modlogs</code>, I want to configure it outside the <code>conf</code> command, how can we do this?</p>
<pre class="prettyprint source lang-javascript"><code>msg.guild.configs.updateOne('modlogs', '267727088465739778', msg.guild);
</code></pre>
<p>Check: <code>Gateway.updateOne</code></p>
<blockquote>
<p>You can use a Channel instance, <a href="SettingResolver.html"><code>SettingResolver</code></a> will make sure the input is valid and the database gets an <strong>ID</strong> and not an object.</p>
</blockquote>
<p>Now, I want to <strong>add</strong> a new user user to the <code>users</code> key, which takes an array.</p>
<pre class="prettyprint source lang-javascript"><code>msg.guild.configs.updateArray(msg.guild, 'add', 'users', '146048938242211840', msg.guild);
</code></pre>
<p>That will add the user <code>'146048938242211840'</code> to the <code>users</code> array. To remove it:</p>
<pre class="prettyprint source lang-javascript"><code>msg.guild.configs.updateArray(msg.guild, 'remove', 'users', '146048938242211840', msg.guild);
</code></pre>
<p>Check: <code>Configuration.updateArray</code></p>
<h2>Removing a key from the guild configuration.</h2>
<p>I have a key which is useless for me, so I <em>want</em> to remove it from the schema.</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.guilds.schema.removeKey('users');
</code></pre>
<h2>Create a new folder to the schema</h2>
<p>It's very similar to how you create a new key into it, but it only accepts three arguments:</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.guilds.schema.addFolder(name, object, force);
</code></pre>
<p>So, let's say I want a key called 'modlogs' into the 'channels' folder for organization. There are two ways to do it:</p>
<h3>Slower</h3>
<pre class="prettyprint source lang-javascript"><code>const { schema } = this.client.gateways.guilds;
async function() {
	await schema.addFolder('channels');
	await schema.channels.addKey('modlogs', { type: 'TextChannel' });
	console.log(schema.channels.modlogs.toJSON());
	// {
	//  	type: 'textchannel',
	//  	array: false,
	//  	default: null,
	//  	min: null,
	//  	max: null,
	//  	configurable: true
	// }
}
</code></pre>
<h3>Faster</h3>
<pre class="prettyprint source lang-javascript"><code>const { schema } = this.client.gateways.guilds;
async function() {
	await schema.addFolder('channels', { modlogs: { type: 'TextChannel' } });
	console.log(schema.channels.modlogs.toJSON());
	// {
	//  	type: 'textchannel',
	//  	array: false,
	//  	default: null,
	//  	min: null,
	//  	max: null,
	//  	configurable: true
	// }
}
</code></pre>
<p>Now, how we do configure it with the built-in conf command? Easy:</p>
<pre class="prettyprint source lang-sh"><code>k!conf set channels.modlogs #modlogs
</code></pre>
<h2>Add a key to the guild configuration's schema if it doesn't exist.</h2>
<p>In <a href="https://github.com/dirigeants/klasa-pieces/">Klasa-Pieces</a>, specially, some pieces require a key from the configuration to work, however, the creator of the pieces does not know if the user who downloads the piece has it, so this function becomes is useful in this case.</p>
<pre class="prettyprint source lang-javascript"><code>const { schema } = this.client.gateways.guilds;
async function() {
	if (!schema.hasKey('modlog')) {
		await schema.addKey('modlog', { type: 'TextChannel' });
	}
}
</code></pre>
<h2>How can I create new Gateway instances?</h2>
<p>By using <a href="GatewayDriver.html"><code>GatewayDriver</code></a>, (available from <code>client.gateways</code>).</p>
<p>Let's say I want to add a new Gateway instance, called <code>channels</code>, which input takes channels, and stores some data to complement our permissions.</p>
<pre class="prettyprint source lang-javascript"><code>// Must use the function keyword or be a method of a class.
async function validate(channelResolvable) {
	// 'this' is referred to the GatewayDriver's instance, it has access
	// to client, resolver...
	const result = await this.resolver.channel(channelResolvable);
	if (result) return result;

	throw 'The parameter &lt;Channel> expects either a Channel ID or a Channel Instance.';
}

// Define the schema for the new Gateway.
const schema = {
	disabledCommands: {
		type: 'Command',
		default: [],
		array: true
	},
	commandThrottle: {
		type: 'Integer',
		default: 5,
		min: 0,
		max: 60
	},
	commandReset: {
		type: 'Integer',
		default: 2,
		min: 0,
		max: 30
	}
};

// Now, we create it:
this.client.gateways.add('channels', validate, schema);
</code></pre>
<blockquote>
<p>Since [<a href="https://github.com/dirigeants/klasa/pull/43">#43</a>], validate only accepts a single argument, instead of being resolver the first one.</p>
</blockquote>
<blockquote>
<p>The <code>validate</code> function must be a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function"><strong>function</strong></a>, not a <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Functions/Arrow_functions"><strong>Arrow Function</strong></a>, the difference between them is that an arrow function binds <code>this</code> to wherever the function has been created (for example, the <code>exports</code> from your eval command, if you are doing this with eval), while the normal functions does not do this.</p>
</blockquote>
<blockquote>
<p>If the <code>validate</code> function does not resolve <strong>Guild</strong> type, you might want to use the fourth argument of <code>Gateway#updateOne</code> (third in Gateway#updateMany), which takes a Guild resolvable.</p>
</blockquote>
<p>And then, you can access to it by:</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.channels;
</code></pre>
<h2>Using different providers in different gateways</h2>
<p>This is new from the SettingGateway v2 (check <a href="https://github.com/dirigeants/klasa/pull/43">#43</a>), when creating a new Gateway (check above for how to do it), there's an extra parameter in <code>client.gateways.add</code> called <code>options</code>. It's optional, but it accepts an object with one key: <code>provider</code>, which is the Provider/SQLProvider (json, leveldb, rethinkdb...). For example:</p>
<pre class="prettyprint source lang-javascript"><code>this.client.gateways.add('channels', validate, schema, { provider: 'rethinkdb' });
</code></pre>
<p>The code above will create a new Gateway instance called 'channels', which will use RethinkDB to store the persistent data.</p>
</article>



</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>

	<a href="https://github.com/dirigeants/klasa">Fork me on Github</a>


	<!-- <span class="copyright">
		<a href="https://github.com/dirigeants/klasa">Fork me on Github</a>
	</span> -->

<!-- <span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.0-dev</a>
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span> -->
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>